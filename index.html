<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reading Data from XML Files</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
</head>
<body>
    <div id="table-container"></div>
    <script>
       
        document.addEventListener('DOMContentLoaded', () => {
            //fetch the data as soon as the page has loaded
            let url = "https://mahdidul.github.io/ao-db/MONSTER.XML";
            fetch(url)
            .then(response=>response.text())
            .then(data => {
                let parser = new DOMParser();
                let xml = parser.parseFromString(data, "application/xml");
                //console.log(xml);
                let arrray = listNpcs(xml);
                var table = new Tabulator("#table-container", {
                    data: arrray, //assign data to table
                    autoColumns: true, //create columns from data field names
                });
                console.log(table);
            });
        })
        
        function listNpcs(x) {
            let dataArray = [];
            let list = document.getElementById('npcs');
            // console.log(list);
            let npcs = x.getElementsByTagName('npc');
            // console.log(npcs);
            for(let i = 0; i < npcs.length; i++){
                try {
                    let li = document.createElement('li');
                    let npc = npcs[i].getAttribute('名稱');
                    let exp = npcs[i].getAttribute('經驗價值');
                    if (exp != null && exp > 0) {
                        let level = npcs[i].getAttribute('等級').replace(/(.)(?=(\d{3})+$)/g,'$1,');
                        let hp = npcs[i].getAttribute('HP').replace(/(.)(?=(\d{3})+$)/g,'$1,');
                        let def = npcs[i].getAttribute('防禦').replace(/(.)(?=(\d{3})+$)/g,'$1,');
                        let mdef = npcs[i].getAttribute('魔防').replace(/(.)(?=(\d{3})+$)/g,'$1,');
                        exp = exp.replace(/(.)(?=(\d{3})+$)/g,'$1,');
                        dataArray.push({ level: level, name: npc, hp: hp, def: def, mdef: mdef, exp: exp });
                    }
                } catch (e) {
                    console.log(e);
                }
            }

            return dataArray;
        }
    </script>
</body>
</html>
